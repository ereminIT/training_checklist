<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏—Ç–Ω–µ—Å-—á–µ–∫–ª–∏—Å—Ç –Ω–∞ –Ω–µ–¥–µ–ª—é</title>
    <style>
        /* ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS ... */
        
        .github-section {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .github-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .github-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .github-saved {
            background: #e8f5e8;
            border: 1px solid #51cf66;
        }
        
        .setup-complete {
            display: none;
            background: var(--success);
            color: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π HTML ... -->
    
    <div class="github-section" id="github-section">
        <h3>üìÅ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å GitHub</h3>
        
        <div id="github-setup">
            <input type="password" id="github-token" class="github-input" 
                   placeholder="GitHub Personal Access Token">
            <input type="text" id="github-username" class="github-input" 
                   placeholder="GitHub –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
            <input type="text" id="github-repo" class="github-input" 
                   placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è">
            
            <div class="github-actions">
                <button id="save-settings">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button id="clear-settings">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>
        </div>
        
        <div id="github-syncing" style="display: none;">
            <div class="setup-complete" id="setup-complete">
                ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!
            </div>
            
            <div class="github-actions">
                <button id="save-github">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ GitHub</button>
                <button id="load-github">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å GitHub</button>
                <button id="auto-sync">üîÑ –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –í–´–ö–õ</button>
            </div>
            
            <p id="last-sync" style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –Ω–∏–∫–æ–≥–¥–∞
            </p>
        </div>
        
        <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">
            –¢–æ–∫–µ–Ω –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤ Settings ‚Üí Developer settings ‚Üí Personal access tokens
            <br>–†–∞–∑—Ä–µ—à–µ–Ω–∏—è: <code>repo</code> –∏ <code>gist</code>
        </p>
    </div>

    <script>
        // ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π JavaScript ...
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        let githubSettings = JSON.parse(localStorage.getItem('githubSettings')) || {};
        let autoSyncEnabled = false;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GitHub —Ä–∞–∑–¥–µ–ª–∞
        document.addEventListener('DOMContentLoaded', function() {
            initGitHubSection();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è GitHub
            document.getElementById('save-settings').addEventListener('click', saveGitHubSettings);
            document.getElementById('clear-settings').addEventListener('click', clearGitHubSettings);
            document.getElementById('save-github').addEventListener('click', saveProgressToGitHub);
            document.getElementById('load-github').addEventListener('click', loadProgressFromGitHub);
            document.getElementById('auto-sync').addEventListener('click', toggleAutoSync);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            if (githubSettings.autoSync) {
                toggleAutoSync();
            }
        });
        
        function initGitHubSection() {
            if (githubSettings.token && githubSettings.username && githubSettings.repo) {
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
                document.getElementById('github-setup').style.display = 'none';
                document.getElementById('github-syncing').style.display = 'block';
                
                if (githubSettings.autoSync) {
                    autoSyncEnabled = true;
                    document.getElementById('auto-sync').textContent = 'üîÑ –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –í–ö–õ';
                    document.getElementById('auto-sync').style.background = 'var(--success)';
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
                const lastSync = localStorage.getItem('lastGitHubSync');
                if (lastSync) {
                    document.getElementById('last-sync').textContent = 
                        `–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: ${new Date(lastSync).toLocaleString()}`;
                }
            }
        }
        
        function saveGitHubSettings() {
            const token = document.getElementById('github-token').value;
            const username = document.getElementById('github-username').value;
            const repo = document.getElementById('github-repo').value;
            
            if (!token || !username || !repo) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            githubSettings = {
                token: token,
                username: username,
                repo: repo,
                autoSync: false
            };
            
            localStorage.setItem('githubSettings', JSON.stringify(githubSettings));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            document.getElementById('setup-complete').style.display = 'block';
            setTimeout(() => {
                document.getElementById('setup-complete').style.display = 'none';
            }, 3000);
            
            initGitHubSection();
        }
        
        function clearGitHubSettings() {
            localStorage.removeItem('githubSettings');
            githubSettings = {};
            document.getElementById('github-token').value = '';
            document.getElementById('github-username').value = '';
            document.getElementById('github-repo').value = '';
            document.getElementById('github-setup').style.display = 'block';
            document.getElementById('github-syncing').style.display = 'none';
            autoSyncEnabled = false;
        }
        
        function toggleAutoSync() {
            autoSyncEnabled = !autoSyncEnabled;
            githubSettings.autoSync = autoSyncEnabled;
            localStorage.setItem('githubSettings', JSON.stringify(githubSettings));
            
            const button = document.getElementById('auto-sync');
            if (autoSyncEnabled) {
                button.textContent = 'üîÑ –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –í–ö–õ';
                button.style.background = 'var(--success)';
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                enableAutoSave();
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å —Å GitHub
                loadProgressFromGitHub();
            } else {
                button.textContent = 'üîÑ –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –í–´–ö–õ';
                button.style.background = 'var(--primary)';
                disableAutoSave();
            }
        }
        
        function enableAutoSave() {
            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const originalUpdateProgress = updateProgress;
            window.updateProgress = function() {
                originalUpdateProgress.apply(this, arguments);
                if (autoSyncEnabled) {
                    setTimeout(saveProgressToGitHub, 1000); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                }
            };
        }
        
        function disableAutoSave() {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
            // (–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å, –µ—Å–ª–∏ —É –≤–∞—Å —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞)
        }
        
        async function saveProgressToGitHub() {
            if (!githubSettings.token) {
                alert('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é');
                return;
            }
            
            const progressData = {
                completedExercises: completedExercises,
                timestamp: new Date().toISOString(),
                version: "1.0"
            };
            
            const content = btoa(unescape(encodeURIComponent(JSON.stringify(progressData, null, 2))));
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
                const getResponse = await fetch(
                    `https://api.github.com/repos/${githubSettings.username}/${githubSettings.repo}/contents/fitness-progress.json`,
                    { headers: { 'Authorization': `token ${githubSettings.token}` } }
                );
                
                let sha = null;
                if (getResponse.status === 200) {
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
                const response = await fetch(
                    `https://api.github.com/repos/${githubSettings.username}/${githubSettings.repo}/contents/fitness-progress.json`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${githubSettings.token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `–§–∏—Ç–Ω–µ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω ${new Date().toLocaleString()}`,
                            content: content,
                            sha: sha
                        })
                    }
                );
                
                if (response.ok) {
                    const lastSync = new Date().toISOString();
                    localStorage.setItem('lastGitHubSync', lastSync);
                    document.getElementById('last-sync').textContent = 
                        `–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: ${new Date(lastSync).toLocaleString()}`;
                    
                    if (!autoSyncEnabled) {
                        alert('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ GitHub!');
                    }
                } else {
                    const error = await response.json();
                    throw new Error(error.message);
                }
            } catch (error) {
                console.error('GitHub sync error:', error);
                if (!autoSyncEnabled) {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                }
            }
        }
        
        async function loadProgressFromGitHub() {
            if (!githubSettings.token) {
                alert('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é');
                return;
            }
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${githubSettings.username}/${githubSettings.repo}/contents/fitness-progress.json`,
                    { headers: { 'Authorization': `token ${githubSettings.token}` } }
                );
                
                if (response.ok) {
                    const fileData = await response.json();
                    const content = JSON.parse(decodeURIComponent(escape(atob(fileData.content))));
                    
                    if (content.completedExercises) {
                        completedExercises = content.completedExercises;
                        localStorage.setItem('completedExercises', JSON.stringify(completedExercises));
                        renderDay(currentWeek, currentDay);
                        updateProgress();
                        
                        const lastSync = new Date().toISOString();
                        localStorage.setItem('lastGitHubSync', lastSync);
                        document.getElementById('last-sync').textContent = 
                            `–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: ${new Date(lastSync).toLocaleString()}`;
                        
                        if (!autoSyncEnabled) {
                            alert('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω —Å GitHub!');
                        }
                    }
                } else if (response.status === 404) {
                    if (!autoSyncEnabled) {
                        alert('–§–∞–π–ª –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ GitHub. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–Ω–∞—á–∞–ª–∞.');
                    }
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ GitHub');
                }
            } catch (error) {
                console.error('GitHub load error:', error);
                if (!autoSyncEnabled) {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                }
            }
        }
    </script>
</body>
</html>